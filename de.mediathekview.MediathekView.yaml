app-id: de.mediathekview.MediathekView
# TODO: Consider Gnome for libnotify?
runtime: org.freedesktop.Platform
runtime-version: '20.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk
command: 'TODO'
finish-args:
  - '--share=network'
  - '--socket=wayland'
  - '--socket=fallback-x11'
  - '--share=ipc'
  - '--device=dri'
  - '--socket=pulseaudio'
  - '--filesystem=xdg-download'
  # See https://github.com/flathub/org.freedesktop.Sdk.Extension.openjdk#usage
  - '--env=PATH=/app/jre/bin:/usr/bin'
modules:
  # See https://github.com/flathub/org.freedesktop.Sdk.Extension.openjdk#usage
  - name: openjdk
    buildsystem: simple
    build-commands: ['/usr/lib/sdk/openjdk/install.sh']
  - name: mediathekview
    buildsystem: simple
    build-options:
      env:
        PATH: /app/bin:/usr/bin:/usr/lib/sdk/openjdk/bin
        MAVEN_OPTS: -Dmaven.repo.local=.m2/repository
        #JAVA_HOME: /usr/lib/sdk/openjdk/jvm/openjdk
      # Enable to regenerate maven-dependencies.yaml
      build-args:
        - '--share=network'
    build-commands:
      # The build process mostly follows Arch's PKGBUILD for MediathekView:
      # https://github.com/archlinux/svntogit-community/blob/packages/mediathekview/trunk/PKGBUILD
      - 'mvn clean install -Plinux,install4j-linux'
      - 'install -Dm644 -t "${FLATPAK_DEST}/share/de.mediathekview.MediathekView" target/MediathekView.jar'
    sources:
      # TODO: Update to 13.8 soon, see https://github.com/mediathekview/MediathekView/issues/610
      - type: archive
        url: 'https://github.com/mediathekview/MediathekView/archive/13.7.1.tar.gz'
        sha512: '1eb2cfd9c69cc84a1b49c8997f6aee1e2bebeebc834ba1a1743f308a0b220d0f95afda9a421187359d04e055501b6af35647636707480f2edc8b0329c3e86a62'
      - type: file
        path: de.mediathekview.MediathekView.desktop
      #- maven-dependencies.yaml
